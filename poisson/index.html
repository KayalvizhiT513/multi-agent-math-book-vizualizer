<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Poisson + Gamma</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root { --primary: #6366f1; --bg: #0f172a; --surface: #1e293b; --text: #f1f5f9; --muted: #94a3b8; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 2rem; }
    .container { max-width: 900px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 2rem; }
    h1 { font-size: 2rem; background: linear-gradient(135deg, var(--primary), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: var(--muted); }
    .simulation { background: var(--surface); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; }
    .dots { display: flex; flex-wrap: wrap; gap: 4px; min-height: 60px; align-items: center; justify-content: center; }
    .dot { width: 12px; height: 12px; border-radius: 50%; background: #10b981; animation: pop 0.3s ease-out; }
    @keyframes pop { 0% { transform: scale(0); } 50% { transform: scale(1.3); } 100% { transform: scale(1); } }
    .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0; }
    .ctrl { background: var(--surface); padding: 1rem; border-radius: 12px; }
    .ctrl label { display: block; margin-bottom: 0.5rem; }
    .ctrl input { width: 100%; }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center; }
    .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
    .stat-label { color: var(--muted); font-size: 0.8rem; }
    button { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; }
    button:hover { opacity: 0.9; }
    .chart { background: var(--surface); border-radius: 16px; padding: 1.5rem; }
    .chart svg { width: 100%; height: 250px; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ðŸ“Š Poisson + Gamma</h1>
      <p class="subtitle">Events per time interval â€” arrivals, clicks, defects</p>
    </header>
    <div class="simulation">
      <h3>Event Simulator</h3>
      <div class="dots" id="dots"></div>
      <div class="controls">
        <div class="ctrl"><label>Rate Î» (expected events): <span id="lambdaVal">5</span></label><input type="range" id="lambda" min="1" max="20" value="5"></div>
        <div class="ctrl"><label>Observations: <span id="obsVal">10</span></label><input type="range" id="obs" min="1" max="50" value="10"></div>
      </div>
      <div class="stats">
        <div><div class="stat-value" id="totalEvents">0</div><div class="stat-label">Total Events</div></div>
        <div><div class="stat-value" id="avgEvents">-</div><div class="stat-label">Avg per Obs</div></div>
        <div><div class="stat-value" id="postMean">-</div><div class="stat-label">Posterior Mean</div></div>
      </div>
      <button onclick="runSimulation()">Run Simulation</button>
    </div>
    <div class="chart"><h3>Posterior: Gamma(Î± + Î£y, Î² + n)</h3><svg id="chart"></svg></div>
  </div>
  <script>
    let data = { lambda: 5, observations: 10, counts: [] };
    function runSimulation() {
      data.counts = [];
      const dots = document.getElementById('dots');
      dots.innerHTML = '';
      for (let i = 0; i < data.observations; i++) {
        let count = 0;
        while (Math.random() < data.lambda / (data.lambda + 10)) count++;
        data.counts.push(count);
        const d = document.createElement('div');
        d.className = 'dot';
        d.style.opacity = Math.min(count / 10 + 0.3, 1);
        dots.appendChild(d);
      }
      updateStats();
    }
    function updateStats() {
      const sum = data.counts.reduce((a,b) => a+b, 0);
      document.getElementById('totalEvents').textContent = sum;
      document.getElementById('avgEvents').textContent = data.observations ? (sum / data.observations).toFixed(2) : '-';
      const postAlpha = 2 + sum;
      const postBeta = 2 + data.observations;
      document.getElementById('postMean').textContent = (postAlpha / postBeta).toFixed(2);
      drawChart(postAlpha, postBeta);
    }
    function gammaPDF(x, a, b) { if (x <= 0) return 0; return Math.pow(b, a) * Math.pow(x, a-1) * Math.exp(-b*x); }
    function drawChart(a, b) {
      const svg = d3.select('#chart');
      svg.selectAll('*').remove();
      const w = 800, h = 250, m = {top:20,right:30,bottom:40,left:50};
      const g = svg.attr('viewBox', `0 0 ${w} ${h}`).append('g').attr('transform', `translate(${m.left},${m.top})`);
      const x = d3.scaleLinear().domain([0, 15]).range([0, w-m.left-m.right]);
      const yMax = gammaPDF((a-1)/b, a, b) * 1.3;
      const y = d3.scaleLinear().domain([0, yMax]).range([h-m.top-m.bottom, 0]);
      g.append('g').attr('transform', `translate(0,${h-m.top-m.bottom})`).call(d3.axisBottom(x));
      g.append('g').call(d3.axisLeft(y));
      const line = d3.line().x(d => x(d[0])).y(d => y(d[1]));
      const xVals = d3.range(0.1, 15, 0.1);
      g.append('path').datum(xVals.map(v => [v, gammaPDF(v, a, b)])).attr('fill','none').attr('stroke','#10b981').attr('stroke-width',3).attr('d',line);
      g.append('line').attr('x1', x(a/b)).attr('x2', x(a/b)).attr('y1', 0).attr('y2', h-m.top-m.bottom).attr('stroke','#f59e0b').attr('stroke-dasharray','4,4');
      g.append('text').attr('x', x(a/b)).attr('y', -5).attr('text-anchor','middle').attr('fill','#f59e0b').text('Mean: ' + (a/b).toFixed(2));
    }
    document.getElementById('lambda').oninput = e => { data.lambda = parseInt(e.target.value); document.getElementById('lambdaVal').textContent = data.lambda; };
    document.getElementById('obs').oninput = e => { data.observations = parseInt(e.target.value); document.getElementById('obsVal').textContent = data.observations; };
    runSimulation();
  </script>
</body>
</html>
