<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exponential + Gamma</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    :root { --primary: #6366f1; --bg: #0f172a; --surface: #1e293b; --text: #f1f5f9; --muted: #94a3b8; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); padding: 2rem; }
    .container { max-width: 900px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 2rem; }
    h1 { font-size: 2rem; background: linear-gradient(135deg, var(--primary), #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: var(--muted); }
    .simulation { background: var(--surface); border-radius: 16px; padding: 2rem; margin-bottom: 1.5rem; }
    .timeline { display: flex; align-items: center; height: 40px; background: var(--bg); border-radius: 8px; margin: 1rem 0; position: relative; }
    .event { position: absolute; width: 8px; height: 8px; border-radius: 50%; background: #10b981; transform: translateX(-50%); }
    .controls { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin: 1rem 0; }
    .ctrl { background: var(--surface); padding: 1rem; border-radius: 12px; }
    .ctrl label { display: block; margin-bottom: 0.5rem; }
    .ctrl input { width: 100%; }
    .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; text-align: center; padding: 1rem; }
    .stat-value { font-size: 1.5rem; font-weight: bold; color: var(--primary); }
    .stat-label { color: var(--muted); font-size: 0.8rem; }
    button { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; cursor: pointer; font-size: 1rem; }
    .chart { background: var(--surface); border-radius: 16px; padding: 1.5rem; }
    .chart svg { width: 100%; height: 250px; }
    .info { background: var(--surface); border-radius: 12px; padding: 1.5rem; border-left: 4px solid var(--primary); margin-top: 1rem; }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>⏱️ Exponential + Gamma</h1>
      <p class="subtitle">Survival times, wait times, reliability analysis</p>
    </header>
    <div class="simulation">
      <h3>Wait Time Simulator</h3>
      <div class="timeline" id="timeline"></div>
      <div class="controls">
        <div class="ctrl"><label>True Rate λ: <span id="trueLambdaVal">1</span></label><input type="range" id="trueLambda" min="0.1" max="5" step="0.1" value="1"></div>
        <div class="ctrl"><label>Observations: <span id="nVal">8</span></label><input type="range" id="n" min="1" max="20" value="8"></div>
      </div>
      <div class="stats">
        <div><div class="stat-value" id="meanTime">-</div><div class="stat-label">Sample Mean</div></div>
        <div><div class="stat-value" id="postMean">-</div><div class="stat-label">Posterior Mean</div></div>
        <div><div class="stat-value" id="credInt">-</div><div class="stat-label">90% Credible Interval</div></div>
      </div>
      <button onclick="runSim()">Generate Data</button>
    </div>
    <div class="chart"><h3>Posterior: Gamma(α + n, β + Σtᵢ)</h3><svg id="chart"></svg></div>
    <div class="info">
      <strong>Update:</strong> With n observations and sum of times S = Σtᵢ, posterior is Gamma(α+n, β+S). The posterior mean = (α+n)/(β+S).
    </div>
  </div>
  <script>
    let observations = [];
    function runSim() {
      const lambda = parseFloat(document.getElementById('trueLambda').value);
      const n = parseInt(document.getElementById('n').value);
      observations = [];
      for (let i = 0; i < n; i++) observations.push(-Math.log(Math.random()) / lambda);
      drawTimeline();
      updateStats();
    }
    function drawTimeline() {
      const tl = document.getElementById('timeline');
      tl.innerHTML = '';
      const maxT = Math.max(...observations) * 1.1;
      observations.forEach((t, i) => {
        const e = document.createElement('div');
        e.className = 'event';
        e.style.left = (t / maxT * 100) + '%';
        e.title = 't' + (i+1) + ': ' + t.toFixed(2);
        tl.appendChild(e);
      });
    }
    function updateStats() {
      const sum = observations.reduce((a,b) => a+b, 0);
      const n = observations.length;
      const sampleMean = n ? sum/n : 0;
      const priorAlpha = 2, priorBeta = 2;
      const postAlpha = priorAlpha + n;
      const postBeta = priorBeta + sum;
      const postMean = postAlpha / postBeta;
      const credLow = postAlpha > 1 ? postAlpha / (postBeta + 1.645 * Math.sqrt(postAlpha / (postBeta * postBeta))) : 0;
      const credHigh = postAlpha / (postBeta - 1.645 * Math.sqrt(postAlpha / (postBeta * postBeta)));
      document.getElementById('meanTime').textContent = sampleMean.toFixed(2);
      document.getElementById('postMean').textContent = postMean.toFixed(2);
      document.getElementById('credInt').textContent = credLow.toFixed(2) + ' - ' + credHigh.toFixed(2);
      drawChart(postAlpha, postBeta);
    }
    function gammaPDF(x, a, b) { if (x <= 0) return 0; return Math.pow(b, a) * Math.pow(x, a-1) * Math.exp(-b*x); }
    function drawChart(a, b) {
      const svg = d3.select('#chart');
      svg.selectAll('*').remove();
      const w = 800, h = 250, m = {top:20,right:30,bottom:40,left:50};
      const g = svg.attr('viewBox', `0 0 ${w} ${h}`).append('g').attr('transform', `translate(${m.left},${m.top})`);
      const x = d3.scaleLinear().domain([0, 6]).range([0, w-m.left-m.right]);
      const yMax = gammaPDF((a-1)/b || 0.5, a, b) * 1.3;
      const y = d3.scaleLinear().domain([0, yMax]).range([h-m.top-m.bottom, 0]);
      g.append('g').attr('transform', `translate(0,${h-m.top-m.bottom})`).call(d3.axisBottom(x));
      g.append('g').call(d3.axisLeft(y));
      const line = d3.line().x(d => x(d[0])).y(d => y(d[1]));
      const xs = d3.range(0.1, 6, 0.1);
      g.append('path').datum(xs.map(v => [v, gammaPDF(v, a, b)])).attr('fill','none').attr('stroke','#10b981').attr('stroke-width',3).attr('d',line);
      g.append('line').attr('x1', x(a/b)).attr('x2', x(a/b)).attr('y1', 0).attr('y2', h-m.top-m.bottom).attr('stroke','#f59e0b').attr('stroke-dasharray','4,4');
    }
    document.getElementById('trueLambda').oninput = e => { document.getElementById('trueLambdaVal').textContent = parseFloat(e.target.value).toFixed(1); };
    document.getElementById('n').oninput = e => { document.getElementById('nVal').textContent = e.target.value; };
    runSim();
  </script>
</body>
</html>
